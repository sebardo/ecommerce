{% extends "AdminBundle:Base:layout.html.twig" %}

{% form_theme form 'AdminBundle:Form:fields.html.twig' %}

{% block section %}products{% endblock %}

{% block content %}
    
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        {{ "new.product" | trans }}
        <small></small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="{{ path('admin_default_index') }}"> <i class="ion-home"></i>  {{ "home" | trans }}</a></li>
        <li><a href="javascript:">{{ "catalogue" | trans }}</a></li>
        <li><a href="{{ path('ecommerce_product_index') }}">{{ "product.plural" | trans }}</a></li>
        <li><a href="{{ path('ecommerce_product_new') }}">{{ "new.singular" | trans }}</a></li>
      </ol>
    </section>
      
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
            <div class="box box-info">
                <!-- form start -->
                <form name="ecommercebundle_producttype" action="{{ path('ecommerce_product_create') }}" method="post" {{ form_enctype(form) }} class="form-horizontal form-row-seperated">
                    <div class="box-body">
                        {{ include('EcommerceBundle:Product:_form.html.twig', { form: form }) }}
                    </div><!-- /.box-body -->
                    <div class="box-footer">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-primary btn-flat"><i class="ion-checkmark"></i> {{ "save" | trans }}</button>
                            <a href="{{ path('ecommerce_product_index') }}" class="btn btn-default btn-flat">{{ "cancel.singular" | trans }}</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
                        
                       
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        jQuery(document).ready(function() {
            
            $('#ecommercebundle_producttype_publishDateRange').daterangepicker(
                {
                    separator: ' ',   
                    format: 'DD/MM/YYYY',
                    timePicker: true,
                    startDate : moment().format('DD/MM/YYYY')
                }
            );
    
            $('#ecommercebundle_producttype_category').select2({
                placeholder: "{{ "category.choose" | trans }}",
                allowClear: true
            });

            $('#ecommercebundle_producttype_brand').select2({
                placeholder: "{{ "brand.choose" | trans }}",
                allowClear: true
            });
            
            $('#ecommercebundle_producttype_brand').change(function(){
                var id = $('#ecommercebundle_producttype_brand').val();
                $.ajax({
                    method: "GET",
                    url: '{{path('ecommerce_brandmodel_modeljson' )}}/'+id,
                }).done(function (results) {
                    var options = '';
                    $.each( results, function( key, value ) {
                         console.log(value);
                         options += "<option value="+ key + ">" + value + "</option>";
                    });
 
                    //console.log(options);
                    
                    $('#ecommercebundle_producttype_model').html(options);
                    $('#ecommercebundle_producttype_model').select2({
                        placeholder: "{{ "model.choose" | trans }}",
                        allowClear: true
                    });

                });
            });
            
            
             
            
            var tipo_precio = jQuery('#ecommercebundle_producttype_priceType').val();
            if(tipo_precio == '1'){
                jQuery('.orifinal-price').hide();
                jQuery('.discount').hide();
                jQuery('.discountType').hide();
                $('.end-price').text('Porcentaje a aplicar');
            }
                
            jQuery('#ecommercebundle_producttype_priceType').change(function(){
                var val= $(this).val();
                console.log(val);
                if(val == '1'){
                    jQuery('.orifinal-price').hide();
                    jQuery('.discount').hide();
                    jQuery('.discountType').hide();
                    $('.end-price').text('Porcentaje a aplicar');
                    
                }else{
                    jQuery('.orifinal-price').show();
                    jQuery('.discount').show();
                    jQuery('.discountType').show();
                    $('.end-price').text('Precio final');
                }
                
            });
            
            jQuery('#ecommercebundle_producttype_discount').focusout(function(){
                precioFinal();
            });
            
            jQuery('#ecommercebundle_producttype_initPrice').focusout(function(){
                precioFinal();
            });
            
            jQuery('#ecommercebundle_producttype_discountType').focusout(function(){
                precioFinal();
            });
            
      
        
        
        
        });
        
        function precioFinal(){
            var precioOri = $('#ecommercebundle_producttype_initPrice').val();
            var tipoDescuento = $('#ecommercebundle_producttype_discountType').val();
            var descuento = $('#ecommercebundle_producttype_discount').val();
            if(precioOri > 0 ){
                var precio_final = calculo(precioOri, tipoDescuento, descuento);
                jQuery('#ecommercebundle_producttype_price').val(precio_final);
                //console.log('tiene precio original hay que realizar calculo'+precio_final);
            }
        }
        
        function calculo(precioOri, tipoDescuento, descuento){
            //veo el tipo 0=%, 1=â‚¬
            if(tipoDescuento == '0'){
                var res = (precioOri / 100) * descuento;
                return precioOri - res;
            }else if(tipoDescuento == '1'){
                return precioOri - descuento;
            }
            
        }
        
    </script>
{% endblock %}